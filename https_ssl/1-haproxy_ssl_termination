# 1-haproxy_ssl_termination
# SSL Termination + HTTP Redirect

global
    log /dev/log local0
    log /dev/log local1 notice
    daemon
    maxconn 2048
    tune.ssl.default-dh-param 2048

defaults
    log global
    mode http
    option httplog
    option dontlognull
    timeout connect 5000
    timeout client 50000
    timeout server 50000

# Redirect all HTTP traffic to HTTPS
frontend http_in
    bind *:80
    redirect scheme https code 301 if !{ ssl_fc }

# Listen on port 443 and handle SSL
frontend https_in
    bind *:443 ssl crt /etc/ssl/private/haproxy.pem
    default_backend web_backend

backend web_backend
    balance roundrobin
    server web1 127.0.0.1:80 check
